diff -Naur nova-2011.2/nova/network/linux_net.py nova-2011.2.new/nova/network/linux_net.py
--- nova-2011.2/nova/network/linux_net.py	2011-04-15 06:57:52.000000000 +0400
+++ nova-2011.2.new/nova/network/linux_net.py	2011-05-23 14:22:22.000000000 +0400
@@ -431,6 +431,7 @@
              "-s %s -j SNAT --to %s" % (fixed_ip, floating_ip))]
 
 
+@utils.synchronized('ensure_vlan', external=True)
 def ensure_vlan_bridge(vlan_num, bridge, net_attrs=None):
     """Create a vlan and bridge unless they already exist"""
     interface = ensure_vlan(vlan_num)
